# 🐳 Docker Compose version (like saying "I speak Docker v3.8")
version: '3.8'

# 🎯 Define your services (think of them as different apps)
services:
  
  # 🧪 Your main API testing service
  api-tests:
    # 🏗️ Build the Docker image from your Dockerfile
    build:
      context: .          # Look for Dockerfile in current directory
      dockerfile: Dockerfile
    
    # 🏷️ Give your container a friendly name
    container_name: api-testing-framework
    
    # 🌍 Environment variables (you can change these!)
    environment:
      - ENV=qa                    # Which environment to test
      - BASE_URL=https://api-qa.example.com
      - LOG_LEVEL=INFO
      - PARALLEL_THREADS=3
    
    # 📁 Map folders from your computer to the container
    # This means reports will appear on your computer!
    volumes:
      - ./reports:/app/reports           # Reports folder
      - ./logs:/app/logs                 # Logs folder
      - ./testdata:/app/testdata         # Test data (in case you update it)
    
    # 🚀 Override the default command if needed
    # command: mvn clean test -Dgroups=smoke
    
    # 🔄 Restart policy
    restart: "no"  # Don't restart automatically (good for tests)

  # 🌐 Optional: Simple web server to view reports (BONUS!)
  report-viewer:
    image: nginx:alpine
    container_name: test-reports-viewer
    ports:
      - "8080:80"                        # Access reports at http://localhost:8080
    volumes:
      - ./reports:/usr/share/nginx/html  # Serve your HTML reports
    depends_on:
      - api-tests                        # Wait for tests to complete
    profiles:
      - reports                          # Only start when specifically requested

# 📊 Optional: Create named volumes for persistent data
volumes:
  test-reports:
  test-logs: